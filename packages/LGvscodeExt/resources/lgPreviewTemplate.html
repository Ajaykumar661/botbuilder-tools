<!DOCTYPE html>
<html lang="en">
<head>
  <title>Language Generation Tester</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style type="text/css"> 
    h1 {
      font-weight: normal;
      padding: 0;
      margin: 0;
    }

    input[type="submit"] {
      background: rgba(43,103,212,1);
      color: #FFF;
      border: none;
      padding: 0.5rem 3rem;
    }

    textarea, input[type="text"] {
      width: 100%;
      font-size: 1rem;
    }

    .panes > div {
      flex-basis: 50%;
      margin: 1rem;
    }

    .results {
      border-top: 2px dashed #666;
      padding-top: 1rem;
      margin: 0;
      margin-top: 1rem;
    }

    .results li {
      margin-bottom: 1rem;
    }
  </style> 
</head>

<body>
<script src="https://microsoft.github.io/monaco-editor/node_modules/monaco-editor/min/vs/loader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js" integrity="sha256-0SGl1PJNDyJwcV5T+weg2zpEMrh7xvlwO4oXgvZCeZk=" crossorigin="anonymous"></script>

  <header>
      <h1>
        Language Generation Tester
      </h1>
      <p>
        Preview the <a href="https://github.com/microsoft/BotBuilder-Samples/blob/master/experimental/language-generation" target="_new">experimental Bot Framework language generation library</a> 
        with this interactive tool that will use your LG rules to generate example language.
        This library is intended for use in generating personalized, contextual responses for bots and other conversational software.
      </p>
    </header>
    <div class="panes">
    <div>
      <p>
        <label for="json">Values used to evaluate expressions (must be valid json)</label>
        <div id="json" style="width:600px;height:240px;border:1px solid grey"></div>
      </p>
      <select id="Template Source" onchange="submitTemplateSource(this)">
        <option value="">Select the source of template</option>
        <option value="Template Name">Template name</option>
        <option value="Free Text">Free text</option>
      </select>
      <div id="getTemplates"> </div>
      <div id="getFreeText"></div>

      <p>
        <label for="iterations">Generate # of variants:</label>
        <input type="number" id="iterations" name="iterations" value="1"/>
      </p>

      <input type="submit" onclick="submitScope()" value="Generate">

      <div class="results">
        <label>Generated Language</label>

        <ol>
          <div id="evaluateresults"> </div>
        </ol>
      </div>
    </div>
  </div>
  <script>
      require.config({ paths: { 'vs': 'https://microsoft.github.io/monaco-editor/node_modules/monaco-editor/min/vs' }});
      require(['vs/editor/editor.main'], function() {
        window.editor = monaco.editor.create(document.getElementById('json'), {
          value: "{}",
          language: 'json',
          theme: 'vs'
        });
      });
  </script>
  <script>
        var vscode = undefined;
        function submitScope() {
            const sourceOptions = document.getElementById("Template Source");
            const source = sourceOptions.options[sourceOptions.selectedIndex].text;
            const scopeValue = window.editor.getValue();
            const iterations = document.getElementById('iterations').value;
            const resultEl = document.getElementById('evaluateresults');
            let templateName = "";
            let inlineText = "";
            if (source === "Template name") {
              const selections = document.getElementById('TemplateName');
              const temp = selections.options[selections.selectedIndex].text;
              templateName = temp;
            } else if (source === "Free text") {
              inlineText = document.getElementById('freetext').value;
            }
            
            if (source !== "Select the source of template") {
              if(vscode === undefined) {
                vscode = acquireVsCodeApi();
              }

              resultEl.innerHTML = '';
              vscode.postMessage({
                  command: 'passScope',
                  scopeValue: scopeValue,
                  templateName: templateName,
                  inlineText: inlineText,
                  iterations: iterations
              });
            }
            
        }

        function submitTemplateSource(source) {
          const sourceValue = source.value;
          let resultList = document.getElementById('getTemplates');
          let resultFreeText = document.getElementById('getFreeText');
          if (sourceValue === "") {
            resultList.innerHTML = "";
            resultFreeText.innerHTML = "";
          } else if (sourceValue=== "Free Text") {
            resultFreeText.innerHTML =  "<p><label for='text'>Free Text</label><input type='text' name='freetext' id='freetext' placeholder='Text to evaluate as a template' value='' onkeypress='document.getElementById('template').value='';'/></p>";
            resultList.innerHTML = "";
          }
          
          else {
            if(vscode === undefined) {
                vscode = acquireVsCodeApi();
            }
          
          resultList = undefined;
          resultFreeText = undefined;

          vscode.postMessage({
            command: 'passTemplateSource',
            source: sourceValue
          });
          }
          
        }

        // Handle the message inside the webview
        window.addEventListener('message', event => {
            const resultEl = document.getElementById('evaluateresults');
            const resultList = document.getElementById('getTemplates');
            const resultFreeText = document.getElementById('getFreeText');
            const message = event.data; // The JSON data our extension sent

            switch (message.command) {
                case 'evaluateResults': {
                   var arr = message.results;
                   resultEl.innerHTML = '';
                    arr.forEach(function(e) {
       		 		        resultEl.innerHTML = resultEl.innerHTML + "<li>" + e + "</li>";
                     })
                  break;
                }

                case 'TemplateName': {
                  var arr = message.results;   
                  resultList.innerHTML = "";
                  let tempStr = "<select id='TemplateName'>";
                  arr.forEach((e) => tempStr = tempStr + `<option value=${e}> ${e} </option>`);
                  resultList.innerHTML = tempStr + "</select>";
                  resultFreeText.innerHTML = "";

                break;
                }
            }
        });
    </script>
</body>
</html>